<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Pegon Al-Kholiqy — FINAL (Fix SESUAI & BUIH)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <style> body { font-family: 'Inter', sans-serif; } </style>
</head>
<body class="bg-gradient-to-b from-green-200 to-white min-h-screen flex flex-col items-center justify-center px-4">

  <header class="text-center mb-8">
    <h1 class="text-4xl md:text-5xl font-bold text-green-800">Pegon Al-Kholiqy</h1>
    <p class="text-gray-700 mt-2">Versi FINAL — Patch SESUAI + BUIH + AI/UI/EI/UA</p>
  </header>

  <main class="bg-white p-6 md:p-10 rounded-xl shadow-lg w-full max-w-3xl">
    <label class="block text-lg font-semibold text-gray-700 mb-2">Teks Latin</label>
    <textarea id="latinInput" rows="6"
      class="w-full p-4 border border-gray-300 rounded-lg mb-4 resize-none focus:outline-none focus:ring-2 focus:ring-green-400"
      placeholder="Tulis teks Latin di sini..."></textarea>

    <button onclick="convert()"
      class="w-full bg-green-600 text-white font-semibold py-3 rounded-lg hover:bg-green-700 transition mb-6">
      Konversi ke Pegon
      <span class="block text-sm opacity-60">Ctrl + Enter</span>
    </button>

    <h2 class="text-xl font-bold text-gray-800 mb-2">Hasil Pegon</h2>
    <div id="pegonOutput" class="bg-gray-50 p-4 border border-gray-300 rounded-lg text-2xl text-right leading-loose"></div>
  </main>

<script>
/* ===============================
   HURUF PEGON
   =============================== */
const pegonMap = {
  ng: 'ڠ', ny: 'ڽ', sy: 'ش', kh: 'خ', sh: 'ش', ch: 'چ',
  a: 'ا', i: 'ي', u: 'و', e: 'ٓ', o: 'و',
  b: 'ب', c: 'چ', d: 'د', f: 'ف', g: 'ڮ', h: 'ه',
  j: 'ج', k: 'ك', l: 'ل', m: 'م', n: 'ن',
  p: 'ڤ', q: 'ق', r: 'ر', s: 'س', t: 'ت',
  v: 'ڤ', w: 'و', x: 'خ', y: 'ي', z: 'ز'
};

const awalanVokal = {
  a:'أ', i:'إي', u:'أو', o:'أو', e:'آ'
};

const angkaMap = { '0':'٠','1':'١','2':'٢','3':'٣','4':'٤','5':'٥','6':'٦','7':'٧','8':'٨','9':'٩' };

const arabOverride = {
  "allah":"الله",
  "sedekah":"صدقة","shodaqoh":"صدقة","sodaqah":"صدقة",
  "syafaat":"شفاعة","syafaatnya":"شفاعاتپا",
  "wudhu":"وضوء","shalat":"صلاة","zakat":"زكاة","iman":"إيمان","islam":"إسلام"
};

const akhiranMap = { nya:"پا", mu:"مو", ku:"كو", kah:"كاه", lah:"لاه", pun:"فون" };

/* ===============================
   DAFTAR DIFTONG KHUSUS
   =============================== */
const diftongAIFullWords = [
  "santai","lalai","ramai","lihai","nilai","pandai",
  "lantai","rantai","balai","serai","selai","pantai"
];

const diftongUIWords = ["kui","duit","kuil","kuih"];

/* ===============================
   UTILITIES
   =============================== */
function stripPunc(s){ return s.replace(/^[\W_]+|[\W_]+$/g,''); }

function wrapWithPunct(original, arab){
  const lead = original.match(/^[\W_]+/) || [''];
  const trail = original.match(/[\W_]+$/) || [''];
  return lead[0] + arab + trail[0];
}

/* ===============================
   KONVERSI TEKS
   =============================== */
function convertToPegon(teks) {
  let parts = teks.split(/(\s+)/);
  let hasil = "";

  for (let part of parts) {
    if (/^\s+$/.test(part)) { hasil += part; continue; }

    let raw = stripPunc(part);
    let lower = raw.toLowerCase();

    // Override kamus
    if (arabOverride[lower]) {
      hasil += wrapWithPunct(part, arabOverride[lower]);
      continue;
    }

    // Akhiran -nya dll untuk kata Arab ta marbuthah
    let matchedSuffix = false;
    for (let suf in akhiranMap) {
      if (lower.endsWith(suf)) {
        let dasar = lower.slice(0, -suf.length);
        if (arabOverride[dasar] && arabOverride[dasar].endsWith("ة")) {
          let temp = arabOverride[dasar].slice(0,-1) + "ت";
          hasil += wrapWithPunct(part, temp + akhiranMap[suf]);
          matchedSuffix = true;
        }
      }
    }
    if (matchedSuffix) continue;

    // Angka
    if (/^\d+$/.test(raw)) {
      hasil += wrapWithPunct(part,
        raw.split('').map(ch => angkaMap[ch] || ch).join('')
      );
      continue;
    }

    hasil += wrapWithPunct(part, convertWord(lower));
  }

  return hasil;
}

/* ===============================
   KONVERSI PER KATA / INTI LOGIKA
   =============================== */
function convertWord(word){
  if (!word) return "";

  /* ------------------------------------
     PATCH #1 — SESUAI (pola "uai")
     ------------------------------------ */
  if (word.includes("uai")) {
    // contoh sesuai, berpasuai, ketidaksesuaiannya
    return convertWord(word.replace(/uai/g,"u_ai_patch"));
  }
  if (word.includes("u_ai_patch")) {
    // konversi: u → و, a → ا, i → ي  => واي
    return word
      .replace(/u_ai_patch/g,"و"+"ا"+"ي")
      .split("")
      .map(ch => pegonMap[ch] || ch)
      .join("");
  }

  /* ------------------------------------
     PATCH #2 — BUIH (UI di tengah)
     ------------------------------------ */
  if (word.startsWith("bui")) {
    // buih -> بوئيه
    return "بوئي" + convertWord(word.slice(3));
  }

  /* ===============================
     ATURAN AI (akhir kata)
     =============================== */
  if (word.endsWith("ai")) {
    // AI diftong (whole-word)
    for (let w of diftongAIFullWords) {
      if (word === w || word.endsWith(w)) {
        let dasar = word.slice(0,-2);
        return convertWord(dasar) + "اي"; // diftong
      }
    }
    // AI dua suku
    let dasar = word.slice(0,-2);
    return convertWord(dasar) + "ائي";
  }

  /* ===============================
     AU
     =============================== */
  if (word.includes("au")) {
    let out=""; let i=0;
    while (i<word.length) {
      if (word.slice(i,i+2)==="au"){ out+="او"; i+=2; continue; }
      let dua = word.slice(i,i+2);
      if (pegonMap[dua]){ out+=pegonMap[dua]; i+=2; continue; }
      out += pegonMap[word[i]] || word[i]; i++;
    }
    return out;
  }

  /* ===============================
     UI (akhir kata)
     =============================== */
  if (word.endsWith("ui")) {
    for (let w of diftongUIWords) {
      if (word === w || word.endsWith(w)) {
        let dasar = word.slice(0,-2);
        return convertWord(dasar) + "وي";
      }
    }
    let dasar = word.slice(0,-2);
    return convertWord(dasar) + "وئي";
  }

  /* ===============================
     IA
     =============================== */
  if (word.endsWith("ia")) {
    if (word==="biaya") return "بيايا";
    let dasar = word.slice(0,-2);
    return convertWord(dasar) + "يا";
  }

  /* ===============================
     KUE
     =============================== */
  if (word === "kue" || word.endsWith("kue")) {
    let dasar = word.slice(0,-3);
    return convertWord(dasar) + "كُوئي";
  }

  /* ===============================
     EI
     =============================== */
  if (word.endsWith("ei")) {
    let dasar = word.slice(0,-2);
    return convertWord(dasar) + "ٓئي";
  }

  /* ===============================
     UA
     =============================== */
  if (word.includes("ua")) {
    let out=''; let i=0;
    while (i<word.length){
      if (word.slice(i,i+2)==='ua'){ out+='وا'; i+=2; continue; }
      let dua=word.slice(i,i+2);
      if (pegonMap[dua]){ out+=pegonMap[dua]; i+=2; continue; }
      out += pegonMap[word[i]] || word[i]; i++;
    }
    return out;
  }

  /* ===============================
     Default huruf per huruf
     =============================== */
  let hasil=""; let i=0;
  if (/^[aeiou]/.test(word)) { hasil+=awalanVokal[word[0]]; i=1; }

  while (i<word.length){
    let dua = word.slice(i,i+2).toLowerCase();
    if (pegonMap[dua]){ hasil+=pegonMap[dua]; i+=2; continue; }
    hasil += pegonMap[word[i]] || word[i];
    i++;
  }
  return hasil;
}

/* ===============================
   BUTTON & SHORTCUT
   =============================== */
function convert(){
  let input = document.getElementById("latinInput").value;
  document.getElementById("pegonOutput").innerText = convertToPegon(input);
}

document.addEventListener("keydown", function(e){
  if (e.ctrlKey && e.key==="Enter") convert();
});
</script>

</body>
</html>
