<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Pegon Al-Kholiqy — Final (Fix AI diftong)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <style> body { font-family: 'Inter', sans-serif; } </style>
</head>
<body class="bg-gradient-to-b from-green-200 to-white min-h-screen flex flex-col items-center justify-center px-4">

  <header class="text-center mb-8">
    <h1 class="text-4xl md:text-5xl font-bold text-green-800">Pegon Al-Kholiqy</h1>
    <p class="text-gray-700 mt-2">Versi final — perbaikan AI diftong & UI</p>
  </header>

  <main class="bg-white p-6 md:p-10 rounded-xl shadow-lg w-full max-w-3xl">
    <label for="latinInput" class="block text-lg font-semibold text-gray-700 mb-2">Teks Latin</label>
    <textarea id="latinInput" rows="6" placeholder="Tulis teks Latin di sini..."
      class="w-full p-4 border border-gray-300 rounded-lg mb-4 resize-none focus:outline-none focus:ring-2 focus:ring-green-400"></textarea>

    <button onclick="convert()"
      class="w-full bg-green-600 text-white font-semibold py-3 rounded-lg hover:bg-green-700 transition mb-6">
      Konversi ke Pegon
      <span class="block text-sm opacity-60">Ctrl + Enter</span>
    </button>

    <h2 class="text-xl font-bold text-gray-800 mb-2">Hasil Pegon</h2>
    <div id="pegonOutput" class="bg-gray-50 p-4 border border-gray-300 rounded-lg text-2xl text-right leading-loose"></div>
  </main>

  <script>
    // PETA HURUF
    const pegonMap = {
      ng: 'ڠ', ny: 'ڽ', sy: 'ش', kh: 'خ', sh: 'ش', ch: 'چ',
      a: 'ا', i: 'ي', u: 'و', e: 'ٓ', o: 'و',
      b: 'ب', c: 'چ', d: 'د', f: 'ف', g: 'ڮ', h: 'ه',
      j: 'ج', k: 'ك', l: 'ل', m: 'م', n: 'ن',
      p: 'ڤ', q: 'ق', r: 'ر', s: 'س', t: 'ت',
      v: 'ڤ', w: 'و', x: 'خ', y: 'ي', z: 'ز'
    };

    const awalanVokal = { a: 'أ', i: 'إي', u: 'أو', o: 'أو', e: 'آ' };
    const angkaMap = { '0':'٠','1':'١','2':'٢','3':'٣','4':'٤','5':'٥','6':'٦','7':'٧','8':'٨','9':'٩' };

    // kamus override (singkat)
    const arabOverride = {
      "allah":"الله",
      "sedekah":"صدقة","shodaqoh":"صدقة","shodaqah":"صدقة","sodaqoh":"صدقة","sodaqah":"صدقة",
      "syafaat":"شفاعة","syafaatnya":"شفاعاتپا","bersyafaat":"بٓرشفاعة",
      "wudhu":"وضوء","shalat":"صلاة","zakat":"زكاة","iman":"إيمان","islam":"إسلام"
      // ... tambah sendiri sesuai batch kamus sebelumnya
    };

    const akhiranMap = { "nya":"پا","mu":"مو","ku":"كو","kah":"كاه","lah":"لاه","pun":"فون" };

    // Daftar kata yang *benar-benar* diftong AI (whole-word)
    const diftongAIFullWords = [
      "santai","lalai","ramai","lihai","nilai","pandai","lantai","rantai",
      "balai","selai","serai","pantai"
    ];

    // Diftong UI yang satu suku
    const diftongUIWords = ["kui","duit","kuil","kuih"];

    function stripPunc(s){ return s.replace(/^[\W_]+|[\W_]+$/g,''); }
    function wrapWithPunct(original, arabWord){
      const lead = original.match(/^[\W_]+/) || [''];
      const trail = original.match(/[\W_]+$/) || [''];
      return lead[0] + arabWord + trail[0];
    }

    function convertToPegon(teks){
      let parts = teks.split(/(\s+)/);
      let hasil = '';
      for (let part of parts){
        if (/^\s+$/.test(part)) { hasil += part; continue; }
        let raw = stripPunc(part);
        let lower = raw.toLowerCase();

        if (arabOverride[lower]) { hasil += wrapWithPunct(part, arabOverride[lower]); continue; }

        // cek akhiran untuk kata arab berakhiran ة
        let matchedSuffix = false;
        for (let suf in akhiranMap) {
          if (lower.endsWith(suf)) {
            let dasar = lower.slice(0, -suf.length);
            if (arabOverride[dasar] && arabOverride[dasar].endsWith("ة")) {
              let arabDasar = arabOverride[dasar];
              let arabTanwin = arabDasar.slice(0, -1) + "ت";
              hasil += wrapWithPunct(part, arabTanwin + akhiranMap[suf]);
              matchedSuffix = true; break;
            }
          }
        }
        if (matchedSuffix) continue;

        if (/^\d+$/.test(raw)) {
          let arabNum = raw.split('').map(ch => angkaMap[ch] || ch).join('');
          hasil += wrapWithPunct(part, arabNum); continue;
        }

        if (lower.startsWith('di') && lower.length>2 && /[a-z]/.test(lower[2])) {
          let after = lower.slice(2);
          let conv = convertWord(after);
          hasil += wrapWithPunct(part, 'دي ' + conv); continue;
        }

        hasil += wrapWithPunct(part, convertWord(lower));
      }
      return hasil;
    }

    function convertWord(word){
      if (!word) return '';

      // ----- AI handling (fixed) -----
      if (word.endsWith("ai")) {
        // jika whole-word termasuk diftong, TULIS sebagai "اي" (alif+ya)
        for (let w of diftongAIFullWords) {
          if (word === w || word.endsWith(w)) {
            let dasar = word.slice(0, -2);
            return convertWord(dasar) + "اي"; // <-- perbaikan: tambahkan alif + ya
          }
        }
        // selain itu (dua suku): gunakan "ائي"
        let dasar = word.slice(0, -2);
        return convertWord(dasar) + "ائي";
      }

      // ----- AU -----
      if (word.includes("au")) {
        let out=''; let i=0;
        while (i<word.length){
          if (word.slice(i,i+2)==='au'){ out += 'او'; i+=2; continue; }
          let dua = word.slice(i,i+2);
          if (pegonMap[dua]){ out += pegonMap[dua]; i+=2; continue; }
          let ch = word[i]; out += pegonMap[ch] || ch; i++;
        }
        return out;
      }

      // ----- UI -----
      if (word.endsWith("ui")) {
        for (let w of diftongUIWords) {
          if (word === w || word.endsWith(w)) {
            let dasar = word.slice(0, -2);
            return convertWord(dasar) + "وي";
          }
        }
        let dasar = word.slice(0, -2);
        return convertWord(dasar) + "وئي";
      }

      // ----- IA -----
      if (word.endsWith("ia")) {
        if (word === "biaya") return "بيايا";
        let dasar = word.slice(0, -2);
        return convertWord(dasar) + "يا";
      }

      // ----- KUE / UE -----
      if (word === "kue" || word.endsWith("kue")) {
        let dasar = word.slice(0, -3);
        return convertWord(dasar) + "كُوئي";
      }

      // ----- EI -----
      if (word.endsWith("ei")) {
        let dasar = word.slice(0, -2);
        return convertWord(dasar) + "ٓئي";
      }

      // ----- UA -----
      if (word.includes("ua")) {
        let out=''; let i=0;
        while (i<word.length){
          if (word.slice(i,i+2)==='ua'){ out += 'وا'; i+=2; continue; }
          let dua = word.slice(i,i+2);
          if (pegonMap[dua]){ out += pegonMap[dua]; i+=2; continue; }
          let ch = word[i]; out += pegonMap[ch] || ch; i++;
        }
        return out;
      }

      // ----- default letter-by-letter -----
      let hasil=''; let i=0;
      if (/^[aeiou]/.test(word)) { hasil += awalanVokal[word[0]] || word[0]; i=1; }
      while (i<word.length){
        let dua = word.slice(i,i+2).toLowerCase();
        if (pegonMap[dua]) { hasil += pegonMap[dua]; i+=2; continue; }
        let satu = word[i].toLowerCase();
        hasil += pegonMap[satu] || word[i]; i++;
      }
      return hasil;
    }

    function convert(){
      let input = document.getElementById("latinInput").value || '';
      let output = convertToPegon(input);
      document.getElementById("pegonOutput").innerText = output;
    }
    document.addEventListener("keydown", function(e){ if (e.ctrlKey && e.key === "Enter") convert(); });
  </script>
</body>
</html>
